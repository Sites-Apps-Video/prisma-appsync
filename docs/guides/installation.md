---
sidebarDepth: 0
---

# Installation

- ðŸ‘‰ [Sample Lambda function](#ðŸ‘‰-bonus-sample-lambda-function)

::: danger
Prisma-AppSync is NOT ready for Production and is only recommended to use for prototyping until a stable version is released. Breaking changes might be introduced at anytime during the beta. Feedback, suggestions and PRs welcomed.
:::

> **Before starting, it is assumed that you have:**
> 
> - A project already setup with Prisma. If not, refer to the [Prisma Quickstart](https://www.prisma.io/docs/getting-started/setup-prisma) guide.
> - A database already created and ready to use with your Prisma project. [DigitalOcean](https://m.do.co/c/f1d537044c2b) generally offers good options for managed databases.

## ðŸŽ¬ Getting started video

[![Getting started video thumbnail](/prisma-appsync-video.png)](http://www.youtube.com/watch?v=v9wIJ02lLG0 "Getting started video")

## Adding Prisma-Appsync into an existing project

### ðŸ‘‰ 1. Add `prisma-appsync` as dev dependency

```bash
# with yarn
yarn add prisma-appsync -D

# with npm
npm install prisma-appsync -D
```

### ðŸ‘‰ 2. Add the generator in your `schema.prisma` file

```typescript
generator appsync {
    provider = "prisma-appsync"
}
```

### ðŸ‘‰ 3. Setup binary targets in your `schema.prisma` file

Adding the binaryTargets will ensure Prisma Engine compatibility with Lambda. For more info, please refer to the [Prisma docs for AWS Lambda](https://www.prisma.io/docs/guides/deployment/deploying-to-aws-lambda#binary-targets-in-schemaprisma).

```typescript{3}
generator client {
    provider = "prisma-client-js"
    binaryTargets = ["native", "rhel-openssl-1.0.x"]
}
```

### ðŸ‘‰ 4. Run `npx prisma generate` as you'd normally do

Prisma-AppSync will generate the below:

```shell
.
+-- generated
|   +-- prisma-appsync
|   |   +-- client/ # API client Class
|   |   +-- docs/ # API Docs
|   |   +-- resolvers.yaml # AppSync Resolvers
|   |   +-- schema.gql # AppSync GQL Schema
```

## Using Prisma-AppSync boilerplate

> **If you have a high level of experience working with Amazon AWS and AppSync, you can stop here and directly use the generated files with your own setup ðŸš€:**
>
> - `resolver.yaml` contain all resolver mapping templates for AppSync.
> - `schema.gql` contain the GraphQL schema for AppSync.
> - `client/` contain Prisma-AppSync client, to be used within your Lambda resolver function ([see example](#ðŸ‘‰-bonus-sample-lambda-function)).

Optionally, you can follow steps 5 & 6 to use our Boilerplate and help you get started with Prisma-AppSync AWS integration.

### ðŸ‘‰ 5. Add the boilerplate into your project

Executed from your project root, the following command will run the interactive installer and ask you some questions:

```shell
# with yarn
yarn create prisma-appsync-app .

# with npm
npm init prisma-appsync-app . --pm npm
```

**The generated `handler.ts` file is a sample Lambda function handler:**

- To be used as principal datasource + resolver for your AWS AppSync API.
- It will contain your core business logic.

**The generated `cdk/` directory contains a sample AWS CDK template to:**

- Prepare and bundle the Lambda function handler.
- Setup AppSync using the files generated by Prisma-AppSync.
- Deploy the API on a specified Amazon AWS account.

### ðŸ‘‰ 6. Deploy the GraphQL API

#### Pre-requirements

Install the [AWS CLI](https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html) and configure your local environment to use your AWS account: [See guide here](https://docs.aws.amazon.com/cdk/latest/guide/cli.html#cli-environment) (`aws configure`). Also install the [AWS CDK](https://github.com/aws/aws-cdk) on your machine (`yarn global add aws-cdk` or `npm i -g aws-cdk`).

#### Deploy using AWS CDK

```shell
# go into the cdk directory
cd cdk

# edit the cdk config to your needs
# (make sure add the config file to your .gitignore)
code .env

# deploy into your AWS Account
cdk deploy
```

**ðŸš€ðŸš€ðŸš€ Done! Your GraphQL API is now ready to use.**

## ðŸ‘‰ Bonus: Sample Lambda function

Unless you have a high level of experience working with Amazon AWS and AppSync, it is recommended to use the Boilerplate provided instead (steps 5 & 6).

```typescript
// import PrismaAppSync client
import { PrismaAppSync } from './prisma/generated/prisma-appsync/client'

// initialise client
const app = new PrismaAppSync({
    connectionUrl: process.env.CONNECTION_URL,
    debug: true
})

// Lambda function handler
export const main = async (event: any, context: any) => {

    // parse the `event` from your Lambda function
    app.parseEvent(event)

    // handle CRUD operations / resolve query
    const result = await app.resolve()

    // close database connection
    await app.prisma.$disconnect()

    // return query result
    return Promise.resolve(result)

})
```
